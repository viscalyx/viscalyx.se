@import 'tailwindcss';
@plugin "@tailwindcss/typography";

/* Configure dark mode to use class-based toggle instead of prefers-color-scheme */
@custom-variant dark (&:where(.dark, .dark *));

/* Custom theme variables for v4 */
@theme {
  /* Colors - Enhanced accessibility palette */
  --color-primary-50: #f0f9ff;
  --color-primary-100: #e0f2fe;
  --color-primary-200: #bae6fd;
  --color-primary-300: #7dd3fc;
  --color-primary-400: #38bdf8;
  --color-primary-500: #0ea5e9;
  --color-primary-600: #0277bd;
  --color-primary-700: #0369a1;
  --color-primary-800: #075985;
  --color-primary-900: #0c4a6e;

  --color-secondary-50: #f9fafb;
  --color-secondary-100: #f3f4f6;
  --color-secondary-200: #e5e7eb;
  --color-secondary-300: #d1d5db;
  --color-secondary-400: #9ca3af;
  --color-secondary-500: #6b7280;
  --color-secondary-600: #4b5563;
  --color-secondary-700: #374151;
  --color-secondary-800: #1f2937;
  --color-secondary-900: #111827;
  --color-secondary-950: #030712;

  /* Accent/Semantic Colors */
  --color-success: #059669;
  --color-warning: #f59e0b;
  --color-important: #7c3aed;
  --color-error: #ef4444;
  --color-info: #3b82f6;
  --color-gold: #facc15;

  /* Data Visualization Colors */
  --color-viz-1: #3b82f6;
  --color-viz-2: #6366f1;
  --color-viz-3: #0ea5e9;
  --color-viz-4: #06b6d4;
  --color-viz-5: #ef4444;
  --color-viz-6: #22c55e;
  --color-viz-7: #a855f7;
  --color-viz-8: #4b5563;

  /* Fonts */
  --font-sans: Inter, system-ui, sans-serif;
}

/* Typography Text Colors - Custom CSS classes to replace Tailwind utilities */
.text-primary-content {
  color: #111827; /* secondary-900 */
}

.text-secondary-content {
  color: #4b5563; /* secondary-600 */
}

.text-tertiary-content {
  color: #374151; /* secondary-700 */
}

.text-muted-content {
  color: #6b7280; /* secondary-500 */
}

.text-brand-primary {
  color: #0277bd; /* primary-600 */
}

.text-success-content {
  color: #16a34a; /* green-600 - semantic success */
}

.text-success-dark {
  color: #065f46; /* green-800 - darker success */
}

.text-warning-amber {
  color: #f59e0b; /* amber-500 */
}

.text-warning-yellow {
  color: #ca8a04; /* yellow-600 */
}

.text-warning-dark {
  color: #713f12; /* yellow-900 */
}

.text-warning-alternative {
  color: #92400e; /* amber-800 */
}

.text-error-red {
  color: #ef4444; /* red-500 */
}

.text-error-alternative {
  color: #dc2626; /* red-600 */
}

.text-error-dark {
  color: #991b1b; /* red-800 */
}

.text-info-blue {
  color: #3b82f6; /* blue-500 */
}

.text-info-alternative {
  color: #1d4ed8; /* blue-700 */
}

.text-info-dark {
  color: #1e40af; /* blue-800 */
}

/* Dark theme overrides */
:is(.dark *) .text-primary-content {
  color: #f9fafb; /* secondary-50 */
}

:is(.dark *) .text-secondary-content {
  color: #9ca3af; /* secondary-400 */
}

:is(.dark *) .text-tertiary-content {
  color: #d1d5db; /* secondary-300 */
}

:is(.dark *) .text-muted-content {
  color: #6b7280; /* secondary-500 - same in both modes */
}

:is(.dark *) .text-brand-primary {
  color: #38bdf8; /* primary-400 */
}

:is(.dark *) .text-success-content {
  color: #4ade80; /* green-400 - semantic success */
}

:is(.dark *) .text-success-dark {
  color: #86efac; /* green-300 - lighter for dark mode */
}

:is(.dark *) .text-warning-amber {
  color: #f59e0b; /* amber-500 - same in both modes */
}

:is(.dark *) .text-warning-yellow {
  color: #facc15; /* yellow-400 */
}

:is(.dark *) .text-warning-dark {
  color: #fefce8; /* yellow-50 */
}

:is(.dark *) .text-warning-alternative {
  color: #fcd34d; /* yellow-300 */
}

:is(.dark *) .text-error-red {
  color: #ef4444; /* red-500 - same in both modes */
}

:is(.dark *) .text-error-alternative {
  color: #f87171; /* red-400 */
}

:is(.dark *) .text-error-dark {
  color: #fca5a5; /* red-300 */
}

:is(.dark *) .text-info-blue {
  color: #3b82f6; /* blue-500 - same in both modes */
}

:is(.dark *) .text-info-alternative {
  color: #60a5fa; /* blue-400 */
}

:is(.dark *) .text-info-dark {
  color: #93c5fd; /* blue-300 */
}

@layer base {
  html {
    scroll-behavior: smooth;
  }

  body {
    @apply bg-white dark:bg-secondary-900 text-secondary-900 dark:text-secondary-100 transition-colors duration-200;
  }

  * {
    @apply border-secondary-200 dark:border-secondary-700;
  }
}

@layer components {
  .btn-primary {
    @apply bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-primary-200 dark:focus:ring-primary-800;
  }

  .btn-secondary {
    @apply bg-white hover:bg-secondary-50 dark:bg-secondary-800 dark:hover:bg-secondary-700 text-secondary-900 dark:text-secondary-100 font-medium py-3 px-6 rounded-lg border border-secondary-200 dark:border-secondary-600 transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-secondary-200 dark:focus:ring-secondary-600;
  }

  .section-padding {
    @apply py-16 px-4 sm:px-6 lg:px-8;
  }

  .container-custom {
    @apply max-w-7xl mx-auto;
  }

  .gradient-bg {
    @apply bg-gradient-to-br from-primary-50 via-white to-secondary-50 dark:from-secondary-900 dark:via-secondary-800 dark:to-secondary-900;
  }

  .card-hover {
    @apply transition-all duration-300 hover:shadow-xl hover:-translate-y-2;
  }

  .text-gradient {
    @apply bg-gradient-to-r from-primary-600 to-primary-800 bg-clip-text text-transparent;
  }
}

@layer utilities {
  .backdrop-blur-custom {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  /* Utility for alert icons - scoped to blog content */
  .blog-content .github-alert-icon {
    @apply w-5 h-5 mr-2 inline-block;
    background-color: currentColor;
    /* Light mode icon mask */
    mask: var(--alert-icon-light) no-repeat center/contain;
    -webkit-mask: var(--alert-icon-light) no-repeat center/contain;
  }

  /* Blog Content Styles - Optimized for Typography Plugin */
  /* Override prose defaults with custom colors and behavior */
  .blog-content {
    @apply text-secondary-700 dark:text-secondary-300;
  }

  /* Headings - Override prose defaults with scroll behavior and custom colors */
  .blog-content h1,
  .blog-content h2,
  .blog-content h3,
  .blog-content h4,
  .blog-content h5,
  .blog-content h6 {
    @apply text-secondary-900 dark:text-secondary-100 scroll-mt-24;
  }

  /* Ensure bold and italic text use normal text colors */
  .blog-content strong,
  .blog-content b {
    @apply text-secondary-700 dark:text-secondary-300 font-bold;
  }

  .blog-content em,
  .blog-content i {
    @apply text-secondary-700 dark:text-secondary-300 italic;
  }

  /* Custom blockquote styling to match site theme */
  .blog-content blockquote {
    @apply border-l-4 border-primary-300 dark:border-primary-600 pl-4 italic text-secondary-600 dark:text-secondary-400;
  }

  /* Remove quote marks from standard blockquotes */
  .blog-content blockquote p:first-of-type::before,
  .blog-content blockquote p:last-of-type::after {
    content: none;
  }

  /* GitHub-style alerts/blockquotes */
  .blog-content .github-alert {
    @apply my-6 rounded-lg border-l-4 p-4 bg-secondary-50 dark:bg-secondary-800;
    /* Use CSS variable for border color */
    border-color: var(--alert-border-color, theme('colors.gray.200'));
  }

  /* Common alert-title styles */
  .blog-content .github-alert .github-alert-title {
    @apply font-bold mb-3 flex items-center gap-2 mt-0;
    /* Use CSS variable for title color */
    color: var(--alert-title-color-light);
  }
  /* Generic dark mode title color override for all alert types */
  .dark .blog-content .github-alert .github-alert-title {
    color: var(--alert-title-color-dark) !important;
  }
  /* The following per-variant dark title overrides are now redundant and can be removed:
       .dark .blog-content .github-alert-warning .github-alert-title { color: var(--alert-title-color-dark) !important; }
       .dark .blog-content .github-alert-caution .github-alert-title { color: var(--alert-title-color-dark) !important; }
     */

  /* Alert content */
  .blog-content .github-alert-content {
    @apply text-secondary-700 dark:text-secondary-300;
    font-style: normal;
    border: none;
    padding: 0;
    margin: 0;
  }

  .blog-content .github-alert-content p {
    @apply text-secondary-700 dark:text-secondary-300 mb-3;
  }

  .blog-content .github-alert-content p:last-child {
    @apply mb-0;
  }

  /* Note variant - centralized via attribute selector */
  .blog-content .github-alert[data-alert-type='note'] {
    --alert-border-color: #3b82f6; /* brand info color */
    --alert-title-color-light: #3b82f6; /* brand info color */
    --alert-title-color-dark: #3b82f6; /* brand info color */
  }

  /* Tip variant - set CSS variables for border, title color */
  .blog-content .github-alert-tip {
    --alert-border-color: #16a34a; /* brand success color */
    --alert-title-color-light: #16a34a; /* brand success color */
    --alert-title-color-dark: #4ade80; /* brand success color */
  }

  /* Important - Purple with exclamation in speech bubble */
  .blog-content .github-alert-important {
    --alert-border-color: #7c3aed; /* brand important color */
    --alert-title-color-light: #7c3aed; /* brand important color */
    --alert-title-color-dark: #7c3aed; /* brand important color */
  }

  /* Warning - Orange/Yellow with triangle exclamation */
  .blog-content .github-alert-warning {
    --alert-border-color: #f59e0b; /* brand warning color */
    --alert-title-color-light: #f59e0b; /* brand warning color */
    --alert-title-color-dark: #f59e0b; /* brand warning color */
  }

  /* Caution alert variant */
  .blog-content .github-alert-caution {
    /* Remove @apply since border-color is set by variable */
    --alert-border-color: #ef4444; /* brand error color */
    --alert-title-color-light: #ef4444; /* brand error color */
    --alert-title-color-dark: #ef4444; /* brand error color */
  }

  /* Quote - Styled like regular blockquote but with visible quote marks */
  .blog-content .github-alert-quote {
    /* Override alert styling to match regular blockquotes */
    @apply border-l-4 border-secondary-400 dark:border-secondary-500 pl-4 italic text-secondary-600 dark:text-secondary-400 bg-transparent dark:bg-transparent my-6 p-0 rounded-none;
  }

  /* Hide the title for quote alerts */
  .blog-content .github-alert-quote .github-alert-title {
    display: none !important;
  }

  /* Style the content like a regular blockquote */
  .blog-content .github-alert-quote .github-alert-content {
    @apply text-secondary-600 dark:text-secondary-400;
    font-style: italic !important;
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  .blog-content .github-alert-quote .github-alert-content p {
    @apply text-secondary-600 dark:text-secondary-400 mb-3;
  }

  .blog-content .github-alert-quote .github-alert-content p:last-child {
    @apply mb-0;
  }

  /* Add quote marks specifically for QUOTE alerts */
  .blog-content
    .github-alert-quote
    .github-alert-content
    p:first-of-type::before {
    content: open-quote;
  }

  .blog-content
    .github-alert-quote
    .github-alert-content
    p:last-of-type::after {
    content: close-quote;
  }

  .blog-content code {
    @apply bg-secondary-100 dark:bg-secondary-800 text-secondary-800 dark:text-secondary-200 px-2 py-1 rounded text-sm;
  }

  /* Remove graphical backticks added by prose plugin */
  .blog-content code::before,
  .blog-content code::after {
    content: none !important;
  }

  /* Ensure inline code in blockquotes and alerts has better contrast */
  .blog-content blockquote code,
  .blog-content .github-alert code {
    @apply bg-white dark:bg-secondary-900 text-secondary-900 dark:text-secondary-100 border border-secondary-300 dark:border-secondary-600;
  }

  /* Also remove prose backticks specifically for blockquote and alert code */
  .blog-content blockquote code::before,
  .blog-content blockquote code::after,
  .blog-content .github-alert code::before,
  .blog-content .github-alert code::after {
    content: none !important;
  }

  .blog-content a {
    @apply text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 underline;
  }

  /* Table of Contents custom scrollbar styles */
  .toc-scrollable {
    /* Show scrollbar always when content overflows */
    overflow-y: auto;

    /* Firefox */
    scrollbar-width: thin;
    scrollbar-color: rgb(156 163 175) transparent; /* secondary-400 for scrollbar thumb */
  }

  /* Webkit scrollbar styling (Chrome, Safari, Edge) */
  .toc-scrollable::-webkit-scrollbar {
    width: 8px;
  }

  .toc-scrollable::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 4px;
  }

  .toc-scrollable::-webkit-scrollbar-thumb {
    @apply bg-secondary-400;
    border-radius: 4px;
    border: 1px solid transparent;
    background-clip: content-box;
  }

  .toc-scrollable::-webkit-scrollbar-thumb:hover {
    @apply bg-secondary-500;
  }

  /* Dark mode scrollbar */
  .dark .toc-scrollable {
    scrollbar-color: theme('colors.secondary.600') transparent;
  }

  .dark .toc-scrollable::-webkit-scrollbar-thumb {
    background-color: rgb(75 85 99); /* secondary-600 */
  }

  .dark .toc-scrollable::-webkit-scrollbar-thumb:hover {
    background-color: rgb(107 114 128); /* secondary-500 */
  }

  /* Scroll indicator animations */
  .scroll-indicator {
    animation: scrollPulse 2s ease-in-out infinite;
    will-change: opacity;
  }

  @keyframes scrollPulse {
    0%,
    100% {
      opacity: 0.6;
    }
    50% {
      opacity: 1;
    }
  }

  /* Heading anchor link styles */
  .heading-with-anchor {
    position: relative;
  }

  .heading-anchor {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 0.5rem;
    opacity: 0;
    transition: opacity 0.2s ease;
    color: rgb(107 114 128); /* secondary-500 */
    text-decoration: none;
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 0.25rem;
    vertical-align: middle;
  }

  .heading-anchor:hover {
    color: rgb(37 99 235); /* blue-600 */
    background-color: rgb(243 244 246); /* secondary-100 */
  }

  .dark .heading-anchor:hover {
    color: rgb(96 165 250); /* blue-400 */
    background-color: rgb(55 65 81); /* secondary-700 */
  }

  .heading-with-anchor:hover .heading-anchor {
    opacity: 1;
  }

  .heading-anchor:focus-visible {
    opacity: 1;
    outline: 2px solid rgb(37 99 235); /* blue-600 */
    outline-offset: 2px;
  }

  .dark .heading-anchor:focus-visible {
    outline-color: rgb(96 165 250); /* blue-400 */
  }

  @media (max-width: 768px) {
    .heading-anchor {
      opacity: 1;
    }
  }

  /* Color blindness simulation filters */
  .filter-protanopia {
    filter: url('#protanopia-filter');
  }

  .filter-deuteranopia {
    filter: url('#deuteranopia-filter');
  }

  .filter-tritanopia {
    filter: url('#tritanopia-filter');
  }

  /* Add SVG filters for color blindness simulation */
  .color-filter-svg {
    position: absolute;
    width: 0;
    height: 0;
    pointer-events: none;
  }

  /* Fallback: CSS-based approximation for color blindness */
  @supports not (filter: url('#protanopia-filter')) {
    .filter-protanopia {
      filter: sepia(100%) hue-rotate(180deg) saturate(0.8);
    }

    .filter-deuteranopia {
      filter: sepia(100%) hue-rotate(90deg) saturate(0.7);
    }

    .filter-tritanopia {
      filter: sepia(100%) hue-rotate(270deg) saturate(0.6);
    }
  }
}
